\hypertarget{namespacedata__cleaning}{}\doxysection{data\+\_\+cleaning Namespace Reference}
\label{namespacedata__cleaning}\index{data\_cleaning@{data\_cleaning}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespacedata__cleaning_adb7bc09232a4801b2d5c1a5b78035b8a}{basic\+\_\+data\+\_\+cleaning}} (df\+\_\+path, save\+\_\+path, voc\+\_\+save\+\_\+path)
\item 
def \mbox{\hyperlink{namespacedata__cleaning_a764780e1efc1aaacceff24440694726e}{replace\+\_\+uncommon\+\_\+words}} (caption\+\_\+df, corpus)
\item 
def \mbox{\hyperlink{namespacedata__cleaning_a2498429c8d36efac9043939416259fa7}{remove\+\_\+too\+\_\+many\+\_\+unk}} (caption\+\_\+df)
\item 
def \mbox{\hyperlink{namespacedata__cleaning_a694b597251ab64cc46aeff32cbac67e1}{remove\+\_\+bad\+\_\+captions}} (caption\+\_\+df)
\item 
def \mbox{\hyperlink{namespacedata__cleaning_a1b2ab30b6289e254c9e531d2ed543a69}{is\+\_\+all\+\_\+one\+\_\+letter}} (caption, letter)
\item 
def \mbox{\hyperlink{namespacedata__cleaning_a814d3761592b8b855cd4ad7222cff896}{number\+\_\+to\+\_\+word}} (word)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacedata__cleaning_a5c8305cd0ba0e7cee6bb715b1707ce9c}{R\+O\+O\+T\+\_\+\+P\+A\+TH}} = Path(\+\_\+\+\_\+file\+\_\+\+\_\+).absolute().parents\mbox{[}2\mbox{]}
\item 
int \mbox{\hyperlink{namespacedata__cleaning_add66ae9bbcbee42740e04fb945f6e3a4}{T\+H\+R\+E\+S\+H\+O\+LD}} = 3
\item 
float \mbox{\hyperlink{namespacedata__cleaning_a0a4dba087f462dce6104221adfbd9f57}{U\+N\+K\+\_\+\+P\+E\+R\+C\+E\+N\+T\+A\+GE}} = 0.\+4
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacedata__cleaning_adb7bc09232a4801b2d5c1a5b78035b8a}\label{namespacedata__cleaning_adb7bc09232a4801b2d5c1a5b78035b8a}} 
\index{data\_cleaning@{data\_cleaning}!basic\_data\_cleaning@{basic\_data\_cleaning}}
\index{basic\_data\_cleaning@{basic\_data\_cleaning}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{basic\_data\_cleaning()}{basic\_data\_cleaning()}}
{\footnotesize\ttfamily def data\+\_\+cleaning.\+basic\+\_\+data\+\_\+cleaning (\begin{DoxyParamCaption}\item[{}]{df\+\_\+path,  }\item[{}]{save\+\_\+path,  }\item[{}]{voc\+\_\+save\+\_\+path }\end{DoxyParamCaption})}

\begin{DoxyVerb}Basic data cleaning entails:
- Converting to lower.
- Removing punctuation.
- Converting numbers to number words and removing large numbers.
- Removing one letter words that are not 'a'.
- Replacing uncommon words with UNK token.
- Removing captions with too many UNK tokens.
- Removing weired mmmmm mm mmm captions.

Parameters
----------
df_path : Path or str. Where the .csv file containing unprocessed
    cases is located.
save_path : Path or str. Where the new .csv file containing
    pre-processed cases will be saved.
voc_save_path : Path or str. Where the vocabulary will be saved.

Returns
-------
Saves cleaned dataset at save_path. saves vocabulary at
voc_save_path.
\end{DoxyVerb}
 

Definition at line 12 of file data\+\_\+cleaning.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{12 \textcolor{keyword}{def }\mbox{\hyperlink{namespacedata__cleaning_adb7bc09232a4801b2d5c1a5b78035b8a}{basic\_data\_cleaning}}(df\_path, save\_path, voc\_save\_path):}
\DoxyCodeLine{13     \textcolor{stringliteral}{"""}}
\DoxyCodeLine{14 \textcolor{stringliteral}{    Basic data cleaning entails:}}
\DoxyCodeLine{15 \textcolor{stringliteral}{    -\/ Converting to lower.}}
\DoxyCodeLine{16 \textcolor{stringliteral}{    -\/ Removing punctuation.}}
\DoxyCodeLine{17 \textcolor{stringliteral}{    -\/ Converting numbers to number words and removing large numbers.}}
\DoxyCodeLine{18 \textcolor{stringliteral}{    -\/ Removing one letter words that are not 'a'.}}
\DoxyCodeLine{19 \textcolor{stringliteral}{    -\/ Replacing uncommon words with UNK token.}}
\DoxyCodeLine{20 \textcolor{stringliteral}{    -\/ Removing captions with too many UNK tokens.}}
\DoxyCodeLine{21 \textcolor{stringliteral}{    -\/ Removing weired mmmmm mm mmm captions.}}
\DoxyCodeLine{22 \textcolor{stringliteral}{}}
\DoxyCodeLine{23 \textcolor{stringliteral}{    Parameters}}
\DoxyCodeLine{24 \textcolor{stringliteral}{    -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{25 \textcolor{stringliteral}{    df\_path : Path or str. Where the .csv file containing unprocessed}}
\DoxyCodeLine{26 \textcolor{stringliteral}{        cases is located.}}
\DoxyCodeLine{27 \textcolor{stringliteral}{    save\_path : Path or str. Where the new .csv file containing}}
\DoxyCodeLine{28 \textcolor{stringliteral}{        pre-\/processed cases will be saved.}}
\DoxyCodeLine{29 \textcolor{stringliteral}{    voc\_save\_path : Path or str. Where the vocabulary will be saved.}}
\DoxyCodeLine{30 \textcolor{stringliteral}{}}
\DoxyCodeLine{31 \textcolor{stringliteral}{    Returns}}
\DoxyCodeLine{32 \textcolor{stringliteral}{    -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{33 \textcolor{stringliteral}{    Saves cleaned dataset at save\_path. saves vocabulary at}}
\DoxyCodeLine{34 \textcolor{stringliteral}{    voc\_save\_path.}}
\DoxyCodeLine{35 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{36     df\_path = Path(df\_path)}
\DoxyCodeLine{37     save\_path = Path(save\_path)}
\DoxyCodeLine{38     voc\_save\_path = Path(voc\_save\_path)}
\DoxyCodeLine{39     caption\_df = pd.read\_csv(df\_path)}
\DoxyCodeLine{40     \textcolor{comment}{\# make a new column for the cleaned version of the caption}}
\DoxyCodeLine{41     \textcolor{comment}{\# I do this because I want to keep the original version}}
\DoxyCodeLine{42     caption\_df[\textcolor{stringliteral}{'clean\_caption'}] = \textcolor{stringliteral}{''}}
\DoxyCodeLine{43     \textcolor{comment}{\# corpus of words, \{word: occurrence in corpus\}}}
\DoxyCodeLine{44     corpus = \{\}}
\DoxyCodeLine{45     table = str.maketrans(\textcolor{stringliteral}{''}, \textcolor{stringliteral}{''}, string.punctuation)}
\DoxyCodeLine{46     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(caption\_df)):}
\DoxyCodeLine{47         cap\_tokens = caption\_df.loc[i, \textcolor{stringliteral}{'caption'}].split()}
\DoxyCodeLine{48         \textcolor{comment}{\# convert to lower}}
\DoxyCodeLine{49         cap\_tokens = [word.lower() \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} cap\_tokens]}
\DoxyCodeLine{50         \textcolor{comment}{\# remove punctuation from each token}}
\DoxyCodeLine{51         cap\_tokens = [word.translate(table) \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} cap\_tokens]}
\DoxyCodeLine{52         \textcolor{comment}{\# converting numbers to number words and remove large numbers}}
\DoxyCodeLine{53         cap\_tokens = [word \textcolor{keywordflow}{if} word.isalpha() \textcolor{keywordflow}{else} \mbox{\hyperlink{namespacedata__cleaning_a814d3761592b8b855cd4ad7222cff896}{number\_to\_word}}(word)}
\DoxyCodeLine{54                       \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} cap\_tokens]}
\DoxyCodeLine{55 }
\DoxyCodeLine{56         \textcolor{comment}{\# remove hanging 's' and other possible weired one letter words}}
\DoxyCodeLine{57         cap\_tokens = [word \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} cap\_tokens}
\DoxyCodeLine{58                       \textcolor{keywordflow}{if} len(word) > 1 \textcolor{keywordflow}{or} word == \textcolor{stringliteral}{'a'}]}
\DoxyCodeLine{59         \textcolor{comment}{\# add words to corpus}}
\DoxyCodeLine{60         \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} cap\_tokens:}
\DoxyCodeLine{61             \textcolor{keywordflow}{if} word \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} corpus.keys():}
\DoxyCodeLine{62                 corpus[word] = 1}
\DoxyCodeLine{63             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{64                 corpus[word] += 1}
\DoxyCodeLine{65 }
\DoxyCodeLine{66         \textcolor{comment}{\# add the cleaned caption to df}}
\DoxyCodeLine{67         caption\_df.at[i, \textcolor{stringliteral}{'clean\_caption'}] = \textcolor{stringliteral}{' '}.join(cap\_tokens)}
\DoxyCodeLine{68     print(\textcolor{stringliteral}{"Full vocabulary size:"}, len(corpus))}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     replace\_corpus, caption\_df = \mbox{\hyperlink{namespacedata__cleaning_a764780e1efc1aaacceff24440694726e}{replace\_uncommon\_words}}(caption\_df, corpus)}
\DoxyCodeLine{71 }
\DoxyCodeLine{72     \textcolor{comment}{\# remove captions with more than 40\% UNK tokens in captions}}
\DoxyCodeLine{73     count\_before = len(caption\_df)}
\DoxyCodeLine{74     caption\_df, remove\_caps\_len = \mbox{\hyperlink{namespacedata__cleaning_a2498429c8d36efac9043939416259fa7}{remove\_too\_many\_unk}}(caption\_df)}
\DoxyCodeLine{75     count\_after = len(caption\_df)}
\DoxyCodeLine{76     \textcolor{keywordflow}{if} count\_after != count\_before -\/ remove\_caps\_len:}
\DoxyCodeLine{77         print(\textcolor{stringliteral}{"Did not remove 40\% UNK captions!!"}}
\DoxyCodeLine{78               \textcolor{stringliteral}{"\(\backslash\)nOr something else went wrong."})}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{comment}{\# remove bad mm mmmmm mmmm captions if they still exist}}
\DoxyCodeLine{81     count\_before = count\_after}
\DoxyCodeLine{82     caption\_df, remove\_caps\_len = \mbox{\hyperlink{namespacedata__cleaning_a694b597251ab64cc46aeff32cbac67e1}{remove\_bad\_captions}}(caption\_df)}
\DoxyCodeLine{83     count\_after = len(caption\_df)}
\DoxyCodeLine{84     \textcolor{keywordflow}{if} count\_after != count\_before -\/ remove\_caps\_len:}
\DoxyCodeLine{85         print(\textcolor{stringliteral}{"Did not remove bad mmmm captions!!"}}
\DoxyCodeLine{86               \textcolor{stringliteral}{"\(\backslash\)nOr something else went wrong."})}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     print(\textcolor{stringliteral}{'vocabulary size that will be used:'},}
\DoxyCodeLine{89           len(corpus) -\/ len(replace\_corpus))}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{comment}{\# check save path}}
\DoxyCodeLine{92     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} save\_path.parent.is\_dir():}
\DoxyCodeLine{93         save\_path.parent.mkdir(parents=\textcolor{keyword}{True})}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     \textcolor{comment}{\# save captions}}
\DoxyCodeLine{96     caption\_df.to\_csv(save\_path)}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \textcolor{comment}{\# vocabulary stuff}}
\DoxyCodeLine{99     vocabulary = [key \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} corpus.keys() \textcolor{keywordflow}{if} corpus[key] >= THRESHOLD]}
\DoxyCodeLine{100     vocabulary.append(\textcolor{stringliteral}{'endseq'})}
\DoxyCodeLine{101     \textcolor{comment}{\# add startseq last so that we can remove it easily from models vocabulary}}
\DoxyCodeLine{102     vocabulary.append(\textcolor{stringliteral}{'startseq'})}
\DoxyCodeLine{103 }
\DoxyCodeLine{104     \textcolor{comment}{\# check voc save path}}
\DoxyCodeLine{105     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} voc\_save\_path.parent.is\_dir():}
\DoxyCodeLine{106         voc\_save\_path.parent.mkdir(parents=\textcolor{keyword}{True})}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \textcolor{keyword}{with} open(voc\_save\_path, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} voc\_file:}
\DoxyCodeLine{109         \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} vocabulary:}
\DoxyCodeLine{110             voc\_file.write(word + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacedata__cleaning_a1b2ab30b6289e254c9e531d2ed543a69}\label{namespacedata__cleaning_a1b2ab30b6289e254c9e531d2ed543a69}} 
\index{data\_cleaning@{data\_cleaning}!is\_all\_one\_letter@{is\_all\_one\_letter}}
\index{is\_all\_one\_letter@{is\_all\_one\_letter}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{is\_all\_one\_letter()}{is\_all\_one\_letter()}}
{\footnotesize\ttfamily def data\+\_\+cleaning.\+is\+\_\+all\+\_\+one\+\_\+letter (\begin{DoxyParamCaption}\item[{}]{caption,  }\item[{}]{letter }\end{DoxyParamCaption})}



Definition at line 181 of file data\+\_\+cleaning.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{181 \textcolor{keyword}{def }\mbox{\hyperlink{namespacedata__cleaning_a1b2ab30b6289e254c9e531d2ed543a69}{is\_all\_one\_letter}}(caption, letter):}
\DoxyCodeLine{182     tmp\_caption = caption[1:len(caption) -\/ 1]}
\DoxyCodeLine{183     \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} tmp\_caption:}
\DoxyCodeLine{184         \textcolor{keywordflow}{for} char \textcolor{keywordflow}{in} word:}
\DoxyCodeLine{185             \textcolor{keywordflow}{if} char != letter:}
\DoxyCodeLine{186                 \textcolor{keywordflow}{return} \textcolor{keyword}{False}}
\DoxyCodeLine{187     \textcolor{keywordflow}{return} \textcolor{keyword}{True}}
\DoxyCodeLine{188 }
\DoxyCodeLine{189 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacedata__cleaning_a814d3761592b8b855cd4ad7222cff896}\label{namespacedata__cleaning_a814d3761592b8b855cd4ad7222cff896}} 
\index{data\_cleaning@{data\_cleaning}!number\_to\_word@{number\_to\_word}}
\index{number\_to\_word@{number\_to\_word}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{number\_to\_word()}{number\_to\_word()}}
{\footnotesize\ttfamily def data\+\_\+cleaning.\+number\+\_\+to\+\_\+word (\begin{DoxyParamCaption}\item[{}]{word }\end{DoxyParamCaption})}



Definition at line 190 of file data\+\_\+cleaning.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{190 \textcolor{keyword}{def }\mbox{\hyperlink{namespacedata__cleaning_a814d3761592b8b855cd4ad7222cff896}{number\_to\_word}}(word):}
\DoxyCodeLine{191     numbers = \{\textcolor{stringliteral}{'0'}: \textcolor{stringliteral}{'zero'}, \textcolor{stringliteral}{'1'}: \textcolor{stringliteral}{'one'}, \textcolor{stringliteral}{'2'}: \textcolor{stringliteral}{'two'}, \textcolor{stringliteral}{'3'}: \textcolor{stringliteral}{'three'}, \textcolor{stringliteral}{'4'}: \textcolor{stringliteral}{'four'},}
\DoxyCodeLine{192                \textcolor{stringliteral}{'5'}: \textcolor{stringliteral}{'five'}, \textcolor{stringliteral}{'6'}: \textcolor{stringliteral}{'six'}, \textcolor{stringliteral}{'7'}: \textcolor{stringliteral}{'seven'}, \textcolor{stringliteral}{'8'}: \textcolor{stringliteral}{'eight'},}
\DoxyCodeLine{193                \textcolor{stringliteral}{'9'}: \textcolor{stringliteral}{'nine'}\}}
\DoxyCodeLine{194     \textcolor{keywordflow}{if} word \textcolor{keywordflow}{in} numbers.keys():}
\DoxyCodeLine{195         \textcolor{keywordflow}{return} numbers[word]}
\DoxyCodeLine{196     \textcolor{keywordflow}{return} \textcolor{stringliteral}{''}}

\end{DoxyCode}
\mbox{\Hypertarget{namespacedata__cleaning_a694b597251ab64cc46aeff32cbac67e1}\label{namespacedata__cleaning_a694b597251ab64cc46aeff32cbac67e1}} 
\index{data\_cleaning@{data\_cleaning}!remove\_bad\_captions@{remove\_bad\_captions}}
\index{remove\_bad\_captions@{remove\_bad\_captions}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{remove\_bad\_captions()}{remove\_bad\_captions()}}
{\footnotesize\ttfamily def data\+\_\+cleaning.\+remove\+\_\+bad\+\_\+captions (\begin{DoxyParamCaption}\item[{}]{caption\+\_\+df }\end{DoxyParamCaption})}

\begin{DoxyVerb}Remove objectively bad captions that do not contain real words.
Here we only remove captions that only consists of the letter m,
since our exploration found that such cases exist in MS COCO.

Parameters
----------
caption_df : DataFrame. contains pre-processed cases.

Returns
-------
caption_df : DataFrame. Where bad captions have been removed.
remove_caps : list. caption_ids of the captions that were removed.
\end{DoxyVerb}
 

Definition at line 154 of file data\+\_\+cleaning.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{154 \textcolor{keyword}{def }\mbox{\hyperlink{namespacedata__cleaning_a694b597251ab64cc46aeff32cbac67e1}{remove\_bad\_captions}}(caption\_df):}
\DoxyCodeLine{155     \textcolor{stringliteral}{"""}}
\DoxyCodeLine{156 \textcolor{stringliteral}{    Remove objectively bad captions that do not contain real words.}}
\DoxyCodeLine{157 \textcolor{stringliteral}{    Here we only remove captions that only consists of the letter m,}}
\DoxyCodeLine{158 \textcolor{stringliteral}{    since our exploration found that such cases exist in MS COCO.}}
\DoxyCodeLine{159 \textcolor{stringliteral}{}}
\DoxyCodeLine{160 \textcolor{stringliteral}{    Parameters}}
\DoxyCodeLine{161 \textcolor{stringliteral}{    -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{162 \textcolor{stringliteral}{    caption\_df : DataFrame. contains pre-\/processed cases.}}
\DoxyCodeLine{163 \textcolor{stringliteral}{}}
\DoxyCodeLine{164 \textcolor{stringliteral}{    Returns}}
\DoxyCodeLine{165 \textcolor{stringliteral}{    -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{166 \textcolor{stringliteral}{    caption\_df : DataFrame. Where bad captions have been removed.}}
\DoxyCodeLine{167 \textcolor{stringliteral}{    remove\_caps : list. caption\_ids of the captions that were removed.}}
\DoxyCodeLine{168 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{169     remove\_caps = []}
\DoxyCodeLine{170     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(caption\_df)):}
\DoxyCodeLine{171         caption = caption\_df.loc[i, \textcolor{stringliteral}{'clean\_caption'}].split()}
\DoxyCodeLine{172         \textcolor{keywordflow}{if} \mbox{\hyperlink{namespacedata__cleaning_a1b2ab30b6289e254c9e531d2ed543a69}{is\_all\_one\_letter}}(caption, \textcolor{stringliteral}{'m'}):}
\DoxyCodeLine{173             print(\textcolor{stringliteral}{"adds mmmmm mmmm to remove"})}
\DoxyCodeLine{174             remove\_caps.append(caption\_df.loc[i, \textcolor{stringliteral}{'caption\_id'}])}
\DoxyCodeLine{175     caption\_df = caption\_df.loc[}
\DoxyCodeLine{176                  \string~caption\_df.loc[:, \textcolor{stringliteral}{'caption\_id'}].isin(remove\_caps), :]}
\DoxyCodeLine{177     caption\_df = caption\_df.reset\_index(drop=\textcolor{keyword}{True})}
\DoxyCodeLine{178     \textcolor{keywordflow}{return} caption\_df, len(remove\_caps)}
\DoxyCodeLine{179 }
\DoxyCodeLine{180 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacedata__cleaning_a2498429c8d36efac9043939416259fa7}\label{namespacedata__cleaning_a2498429c8d36efac9043939416259fa7}} 
\index{data\_cleaning@{data\_cleaning}!remove\_too\_many\_unk@{remove\_too\_many\_unk}}
\index{remove\_too\_many\_unk@{remove\_too\_many\_unk}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{remove\_too\_many\_unk()}{remove\_too\_many\_unk()}}
{\footnotesize\ttfamily def data\+\_\+cleaning.\+remove\+\_\+too\+\_\+many\+\_\+unk (\begin{DoxyParamCaption}\item[{}]{caption\+\_\+df }\end{DoxyParamCaption})}

\begin{DoxyVerb}Remove captions with too many UNK tokens in the caption.

Parameters
----------
caption_df : DataFrame. contains pre-processed cases.

Returns
-------
caption_df : DataFrame. Where captions with too many UNKs have
    been removed.
remove_caps : list. caption_ids of the captions that were removed.
\end{DoxyVerb}
 

Definition at line 126 of file data\+\_\+cleaning.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{126 \textcolor{keyword}{def }\mbox{\hyperlink{namespacedata__cleaning_a2498429c8d36efac9043939416259fa7}{remove\_too\_many\_unk}}(caption\_df):}
\DoxyCodeLine{127     \textcolor{stringliteral}{"""}}
\DoxyCodeLine{128 \textcolor{stringliteral}{    Remove captions with too many UNK tokens in the caption.}}
\DoxyCodeLine{129 \textcolor{stringliteral}{}}
\DoxyCodeLine{130 \textcolor{stringliteral}{    Parameters}}
\DoxyCodeLine{131 \textcolor{stringliteral}{    -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{132 \textcolor{stringliteral}{    caption\_df : DataFrame. contains pre-\/processed cases.}}
\DoxyCodeLine{133 \textcolor{stringliteral}{}}
\DoxyCodeLine{134 \textcolor{stringliteral}{    Returns}}
\DoxyCodeLine{135 \textcolor{stringliteral}{    -\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{136 \textcolor{stringliteral}{    caption\_df : DataFrame. Where captions with too many UNKs have}}
\DoxyCodeLine{137 \textcolor{stringliteral}{        been removed.}}
\DoxyCodeLine{138 \textcolor{stringliteral}{    remove\_caps : list. caption\_ids of the captions that were removed.}}
\DoxyCodeLine{139 \textcolor{stringliteral}{    """}}
\DoxyCodeLine{140     remove\_caps = []}
\DoxyCodeLine{141     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(caption\_df)):}
\DoxyCodeLine{142         caption = caption\_df.loc[i, \textcolor{stringliteral}{'clean\_caption'}].split()}
\DoxyCodeLine{143         length = len(caption)}
\DoxyCodeLine{144         unks = sum([1 \textcolor{keywordflow}{if} w == \textcolor{stringliteral}{'UNK'} \textcolor{keywordflow}{else} 0 \textcolor{keywordflow}{for} w \textcolor{keywordflow}{in} caption])}
\DoxyCodeLine{145         \textcolor{keywordflow}{if} unks / length > UNK\_PERCENTAGE:}
\DoxyCodeLine{146             print(\textcolor{stringliteral}{"removes too many UNKs"})}
\DoxyCodeLine{147             remove\_caps.append(caption\_df.loc[i, \textcolor{stringliteral}{'caption\_id'}])}
\DoxyCodeLine{148     caption\_df = caption\_df.loc[}
\DoxyCodeLine{149                  \string~caption\_df.loc[:, \textcolor{stringliteral}{'caption\_id'}].isin(remove\_caps), :]}
\DoxyCodeLine{150     caption\_df = caption\_df.reset\_index(drop=\textcolor{keyword}{True})}
\DoxyCodeLine{151     \textcolor{keywordflow}{return} caption\_df, len(remove\_caps)}
\DoxyCodeLine{152 }
\DoxyCodeLine{153 }

\end{DoxyCode}
\mbox{\Hypertarget{namespacedata__cleaning_a764780e1efc1aaacceff24440694726e}\label{namespacedata__cleaning_a764780e1efc1aaacceff24440694726e}} 
\index{data\_cleaning@{data\_cleaning}!replace\_uncommon\_words@{replace\_uncommon\_words}}
\index{replace\_uncommon\_words@{replace\_uncommon\_words}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{replace\_uncommon\_words()}{replace\_uncommon\_words()}}
{\footnotesize\ttfamily def data\+\_\+cleaning.\+replace\+\_\+uncommon\+\_\+words (\begin{DoxyParamCaption}\item[{}]{caption\+\_\+df,  }\item[{}]{corpus }\end{DoxyParamCaption})}



Definition at line 113 of file data\+\_\+cleaning.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{113 \textcolor{keyword}{def }\mbox{\hyperlink{namespacedata__cleaning_a764780e1efc1aaacceff24440694726e}{replace\_uncommon\_words}}(caption\_df, corpus):}
\DoxyCodeLine{114     \textcolor{comment}{\# replace words with less than THRESHOLD occurrences with an UNK}}
\DoxyCodeLine{115     \textcolor{comment}{\# token}}
\DoxyCodeLine{116     replace\_corpus = set([key \textcolor{keywordflow}{for} key \textcolor{keywordflow}{in} corpus \textcolor{keywordflow}{if} corpus[key] < THRESHOLD])}
\DoxyCodeLine{117     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} range(len(caption\_df)):}
\DoxyCodeLine{118         cap\_tokens = caption\_df.loc[i, \textcolor{stringliteral}{'clean\_caption'}].split()}
\DoxyCodeLine{119         cap\_tokens = [word \textcolor{keywordflow}{if} word \textcolor{keywordflow}{not} \textcolor{keywordflow}{in} replace\_corpus \textcolor{keywordflow}{else} \textcolor{stringliteral}{'UNK'}}
\DoxyCodeLine{120                       \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} cap\_tokens]}
\DoxyCodeLine{121         cap\_tokens = [\textcolor{stringliteral}{'startseq'}] + cap\_tokens + [\textcolor{stringliteral}{'endseq'}]}
\DoxyCodeLine{122         caption\_df.at[i, \textcolor{stringliteral}{'clean\_caption'}] = \textcolor{stringliteral}{' '}.join(cap\_tokens)}
\DoxyCodeLine{123     \textcolor{keywordflow}{return} replace\_corpus, caption\_df}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 }

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespacedata__cleaning_a5c8305cd0ba0e7cee6bb715b1707ce9c}\label{namespacedata__cleaning_a5c8305cd0ba0e7cee6bb715b1707ce9c}} 
\index{data\_cleaning@{data\_cleaning}!ROOT\_PATH@{ROOT\_PATH}}
\index{ROOT\_PATH@{ROOT\_PATH}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{ROOT\_PATH}{ROOT\_PATH}}
{\footnotesize\ttfamily data\+\_\+cleaning.\+R\+O\+O\+T\+\_\+\+P\+A\+TH = Path(\+\_\+\+\_\+file\+\_\+\+\_\+).absolute().parents\mbox{[}2\mbox{]}}



Definition at line 6 of file data\+\_\+cleaning.\+py.

\mbox{\Hypertarget{namespacedata__cleaning_add66ae9bbcbee42740e04fb945f6e3a4}\label{namespacedata__cleaning_add66ae9bbcbee42740e04fb945f6e3a4}} 
\index{data\_cleaning@{data\_cleaning}!THRESHOLD@{THRESHOLD}}
\index{THRESHOLD@{THRESHOLD}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{THRESHOLD}{THRESHOLD}}
{\footnotesize\ttfamily int data\+\_\+cleaning.\+T\+H\+R\+E\+S\+H\+O\+LD = 3}



Definition at line 8 of file data\+\_\+cleaning.\+py.

\mbox{\Hypertarget{namespacedata__cleaning_a0a4dba087f462dce6104221adfbd9f57}\label{namespacedata__cleaning_a0a4dba087f462dce6104221adfbd9f57}} 
\index{data\_cleaning@{data\_cleaning}!UNK\_PERCENTAGE@{UNK\_PERCENTAGE}}
\index{UNK\_PERCENTAGE@{UNK\_PERCENTAGE}!data\_cleaning@{data\_cleaning}}
\doxysubsubsection{\texorpdfstring{UNK\_PERCENTAGE}{UNK\_PERCENTAGE}}
{\footnotesize\ttfamily float data\+\_\+cleaning.\+U\+N\+K\+\_\+\+P\+E\+R\+C\+E\+N\+T\+A\+GE = 0.\+4}



Definition at line 9 of file data\+\_\+cleaning.\+py.

