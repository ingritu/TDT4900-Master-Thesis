\hypertarget{namespace_resnet__features}{}\doxysection{Resnet\+\_\+features Namespace Reference}
\label{namespace_resnet__features}\index{Resnet\_features@{Resnet\_features}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespace_resnet__features_ab75b1a569482335859c7d1a3019baebe}{load\+\_\+pre\+\_\+trained\+\_\+model}} (output\+\_\+layer\+\_\+idx)
\item 
def \mbox{\hyperlink{namespace_resnet__features_afc7f540bb1a4cb34b2deab258a7942a9}{load\+\_\+inception}} ()
\item 
def \mbox{\hyperlink{namespace_resnet__features_a4ae1659ff8ba6549340fa4afb8c8ddf0}{encode}} (image, model)
\item 
def \mbox{\hyperlink{namespace_resnet__features_ab66ba451cf404ceca301f155de39be16}{encode\+\_\+vis\+\_\+att}} (image, model)
\item 
def \mbox{\hyperlink{namespace_resnet__features_a6c85bc4241a506a1129806113a9a5490}{extract\+\_\+image\+\_\+features}} (image\+\_\+path, save\+\_\+path, split\+\_\+set\+\_\+path, output\+\_\+layer\+\_\+idx, vis\+\_\+att=True)
\item 
def \mbox{\hyperlink{namespace_resnet__features_ad88130cec5722ee72d64f68b692036d1}{load\+\_\+visual\+\_\+features}} (feature\+\_\+path)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespace_resnet__features_a6a2cb3574c119736d457d1bb165b267e}{R\+O\+O\+T\+\_\+\+P\+A\+TH}} = Path(\+\_\+\+\_\+file\+\_\+\+\_\+).absolute().parents\mbox{[}2\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespace_resnet__features_a4ae1659ff8ba6549340fa4afb8c8ddf0}\label{namespace_resnet__features_a4ae1659ff8ba6549340fa4afb8c8ddf0}} 
\index{Resnet\_features@{Resnet\_features}!encode@{encode}}
\index{encode@{encode}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{encode()}{encode()}}
{\footnotesize\ttfamily def Resnet\+\_\+features.\+encode (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{model }\end{DoxyParamCaption})}



Definition at line 30 of file Resnet\+\_\+features.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{30 \textcolor{keyword}{def }\mbox{\hyperlink{namespace_resnet__features_a4ae1659ff8ba6549340fa4afb8c8ddf0}{encode}}(image, model):}
\DoxyCodeLine{31     \textcolor{keyword}{from} keras.applications.inception\_resnet\_v2 \textcolor{keyword}{import} preprocess\_input}
\DoxyCodeLine{32     \textcolor{comment}{\# add one more dimension}}
\DoxyCodeLine{33     image = np.expand\_dims(image, axis=0)}
\DoxyCodeLine{34     \textcolor{comment}{\# preprocess the image}}
\DoxyCodeLine{35     image = preprocess\_input(image)}
\DoxyCodeLine{36     \textcolor{comment}{\# Get the encoding vector for the image}}
\DoxyCodeLine{37     fea\_vec = model.predict(image)}
\DoxyCodeLine{38     \textcolor{comment}{\# reshape from (1, 2048) to (2048, )}}
\DoxyCodeLine{39     fea\_vec = np.reshape(fea\_vec, fea\_vec.shape[1])}
\DoxyCodeLine{40     \textcolor{keywordflow}{return} fea\_vec}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 }

\end{DoxyCode}
\mbox{\Hypertarget{namespace_resnet__features_ab66ba451cf404ceca301f155de39be16}\label{namespace_resnet__features_ab66ba451cf404ceca301f155de39be16}} 
\index{Resnet\_features@{Resnet\_features}!encode\_vis\_att@{encode\_vis\_att}}
\index{encode\_vis\_att@{encode\_vis\_att}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{encode\_vis\_att()}{encode\_vis\_att()}}
{\footnotesize\ttfamily def Resnet\+\_\+features.\+encode\+\_\+vis\+\_\+att (\begin{DoxyParamCaption}\item[{}]{image,  }\item[{}]{model }\end{DoxyParamCaption})}



Definition at line 43 of file Resnet\+\_\+features.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{43 \textcolor{keyword}{def }\mbox{\hyperlink{namespace_resnet__features_ab66ba451cf404ceca301f155de39be16}{encode\_vis\_att}}(image, model):}
\DoxyCodeLine{44     \textcolor{keyword}{from} keras.applications.inception\_resnet\_v2 \textcolor{keyword}{import} preprocess\_input}
\DoxyCodeLine{45     \textcolor{comment}{\# add one more dimension}}
\DoxyCodeLine{46     image = np.expand\_dims(image, axis=0)}
\DoxyCodeLine{47     \textcolor{comment}{\# preprocess the image}}
\DoxyCodeLine{48     image = preprocess\_input(image)}
\DoxyCodeLine{49     \textcolor{comment}{\# Get the encoding vector for the image}}
\DoxyCodeLine{50     fea\_vec = model.predict(image)}
\DoxyCodeLine{51     \textcolor{comment}{\# reshape from (1, 8, 8, 1536) to (8, 8, 1536)}}
\DoxyCodeLine{52     fea\_vec = np.reshape(fea\_vec, fea\_vec.shape[1:])}
\DoxyCodeLine{53     \textcolor{keywordflow}{return} fea\_vec}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 }

\end{DoxyCode}
\mbox{\Hypertarget{namespace_resnet__features_a6c85bc4241a506a1129806113a9a5490}\label{namespace_resnet__features_a6c85bc4241a506a1129806113a9a5490}} 
\index{Resnet\_features@{Resnet\_features}!extract\_image\_features@{extract\_image\_features}}
\index{extract\_image\_features@{extract\_image\_features}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{extract\_image\_features()}{extract\_image\_features()}}
{\footnotesize\ttfamily def Resnet\+\_\+features.\+extract\+\_\+image\+\_\+features (\begin{DoxyParamCaption}\item[{}]{image\+\_\+path,  }\item[{}]{save\+\_\+path,  }\item[{}]{split\+\_\+set\+\_\+path,  }\item[{}]{output\+\_\+layer\+\_\+idx,  }\item[{}]{vis\+\_\+att = {\ttfamily True} }\end{DoxyParamCaption})}



Definition at line 56 of file Resnet\+\_\+features.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{56 \textcolor{keyword}{def }\mbox{\hyperlink{namespace_resnet__features_a6c85bc4241a506a1129806113a9a5490}{extract\_image\_features}}(image\_path,}
\DoxyCodeLine{57                            save\_path,}
\DoxyCodeLine{58                            split\_set\_path,}
\DoxyCodeLine{59                            output\_layer\_idx,}
\DoxyCodeLine{60                            vis\_att=True):}
\DoxyCodeLine{61     \textcolor{comment}{\# consider splitting the process up in parts and then}}
\DoxyCodeLine{62     \textcolor{comment}{\# combining the parts at the end, to reduce the amount of images}}
\DoxyCodeLine{63     \textcolor{comment}{\# in memory at any time}}
\DoxyCodeLine{64     image\_path = Path(image\_path)}
\DoxyCodeLine{65     save\_path = Path(save\_path)}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} save\_path.is\_dir():}
\DoxyCodeLine{68         save\_path.mkdir(parents=\textcolor{keyword}{True})}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     model = \mbox{\hyperlink{namespace_resnet__features_ab75b1a569482335859c7d1a3019baebe}{load\_pre\_trained\_model}}(output\_layer\_idx)}
\DoxyCodeLine{71     data\_df = pd.read\_csv(split\_set\_path)}
\DoxyCodeLine{72     image\_split = set(data\_df.loc[:, \textcolor{stringliteral}{'image\_id'}])}
\DoxyCodeLine{73     start = time()}
\DoxyCodeLine{74     encoding\_data = \{\}}
\DoxyCodeLine{75     n = len(image\_split)}
\DoxyCodeLine{76     count = 0}
\DoxyCodeLine{77     \textcolor{keywordflow}{for} im\_file \textcolor{keywordflow}{in} image\_path.glob(\textcolor{stringliteral}{'*.jpg'}):}
\DoxyCodeLine{78         p = len(\mbox{\hyperlink{namespacetrain__model_af1334e726c4782724a0e5b8f9e031e01}{str}}(im\_file.parent)) + 1}
\DoxyCodeLine{79         im\_file = \mbox{\hyperlink{namespacetrain__model_af1334e726c4782724a0e5b8f9e031e01}{str}}(im\_file)}
\DoxyCodeLine{80         image\_name = im\_file[p:]}
\DoxyCodeLine{81         \textcolor{keywordflow}{if} image\_name \textcolor{keywordflow}{in} image\_split:}
\DoxyCodeLine{82             count += 1}
\DoxyCodeLine{83             \textcolor{keywordflow}{if} vis\_att:}
\DoxyCodeLine{84                 encoding\_data[image\_name] = \mbox{\hyperlink{namespace_resnet__features_ab66ba451cf404ceca301f155de39be16}{encode\_vis\_att}}(imread(im\_file),}
\DoxyCodeLine{85                                                            model)}
\DoxyCodeLine{86             \textcolor{keywordflow}{else}:}
\DoxyCodeLine{87                 encoding\_data[image\_name] = \mbox{\hyperlink{namespace_resnet__features_a4ae1659ff8ba6549340fa4afb8c8ddf0}{encode}}(imread(im\_file), model)}
\DoxyCodeLine{88             print(\mbox{\hyperlink{namespacetrain__model_af1334e726c4782724a0e5b8f9e031e01}{str}}(count) + \textcolor{stringliteral}{' / '} + \mbox{\hyperlink{namespacetrain__model_af1334e726c4782724a0e5b8f9e031e01}{str}}(n))}
\DoxyCodeLine{89     print(\textcolor{stringliteral}{"Time taken in seconds ="}, time() -\/ start)}
\DoxyCodeLine{90     \textcolor{comment}{\# Save the bottleneck train features to disk}}
\DoxyCodeLine{91     \textcolor{keyword}{with} open(save\_path, \textcolor{stringliteral}{"wb"}) \textcolor{keyword}{as} encoded\_pickle:}
\DoxyCodeLine{92         dump(encoding\_data, encoded\_pickle)}
\DoxyCodeLine{93 }
\DoxyCodeLine{94 }

\end{DoxyCode}
\mbox{\Hypertarget{namespace_resnet__features_afc7f540bb1a4cb34b2deab258a7942a9}\label{namespace_resnet__features_afc7f540bb1a4cb34b2deab258a7942a9}} 
\index{Resnet\_features@{Resnet\_features}!load\_inception@{load\_inception}}
\index{load\_inception@{load\_inception}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{load\_inception()}{load\_inception()}}
{\footnotesize\ttfamily def Resnet\+\_\+features.\+load\+\_\+inception (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Definition at line 21 of file Resnet\+\_\+features.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{21 \textcolor{keyword}{def }\mbox{\hyperlink{namespace_resnet__features_afc7f540bb1a4cb34b2deab258a7942a9}{load\_inception}}():}
\DoxyCodeLine{22     \textcolor{keyword}{from} keras.applications.inception\_v3 \textcolor{keyword}{import} InceptionV3}
\DoxyCodeLine{23     \textcolor{keyword}{from} keras.models \textcolor{keyword}{import} Model}
\DoxyCodeLine{24     model = InceptionV3(weights=\textcolor{stringliteral}{'imagenet'})}
\DoxyCodeLine{25     new\_model = Model(model.input, model.layers[-\/2].output)}
\DoxyCodeLine{26     new\_model.summary()}
\DoxyCodeLine{27     \textcolor{keywordflow}{return} new\_model}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 }

\end{DoxyCode}
\mbox{\Hypertarget{namespace_resnet__features_ab75b1a569482335859c7d1a3019baebe}\label{namespace_resnet__features_ab75b1a569482335859c7d1a3019baebe}} 
\index{Resnet\_features@{Resnet\_features}!load\_pre\_trained\_model@{load\_pre\_trained\_model}}
\index{load\_pre\_trained\_model@{load\_pre\_trained\_model}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{load\_pre\_trained\_model()}{load\_pre\_trained\_model()}}
{\footnotesize\ttfamily def Resnet\+\_\+features.\+load\+\_\+pre\+\_\+trained\+\_\+model (\begin{DoxyParamCaption}\item[{}]{output\+\_\+layer\+\_\+idx }\end{DoxyParamCaption})}



Definition at line 12 of file Resnet\+\_\+features.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{12 \textcolor{keyword}{def }\mbox{\hyperlink{namespace_resnet__features_ab75b1a569482335859c7d1a3019baebe}{load\_pre\_trained\_model}}(output\_layer\_idx):}
\DoxyCodeLine{13     \textcolor{keyword}{from} keras.applications.inception\_resnet\_v2 \textcolor{keyword}{import} InceptionResNetV2}
\DoxyCodeLine{14     \textcolor{keyword}{from} keras.models \textcolor{keyword}{import} Model}
\DoxyCodeLine{15     model = InceptionResNetV2(weights=\textcolor{stringliteral}{'imagenet'})}
\DoxyCodeLine{16     model\_new = Model(model.input, model.layers[output\_layer\_idx].output)}
\DoxyCodeLine{17     model\_new.summary()}
\DoxyCodeLine{18     \textcolor{keywordflow}{return} model\_new}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 }

\end{DoxyCode}
\mbox{\Hypertarget{namespace_resnet__features_ad88130cec5722ee72d64f68b692036d1}\label{namespace_resnet__features_ad88130cec5722ee72d64f68b692036d1}} 
\index{Resnet\_features@{Resnet\_features}!load\_visual\_features@{load\_visual\_features}}
\index{load\_visual\_features@{load\_visual\_features}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{load\_visual\_features()}{load\_visual\_features()}}
{\footnotesize\ttfamily def Resnet\+\_\+features.\+load\+\_\+visual\+\_\+features (\begin{DoxyParamCaption}\item[{}]{feature\+\_\+path }\end{DoxyParamCaption})}



Definition at line 95 of file Resnet\+\_\+features.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{95 \textcolor{keyword}{def }\mbox{\hyperlink{namespace_resnet__features_ad88130cec5722ee72d64f68b692036d1}{load\_visual\_features}}(feature\_path):}
\DoxyCodeLine{96     \textcolor{keyword}{with} open(feature\_path, \textcolor{stringliteral}{'rb'}) \textcolor{keyword}{as} file:}
\DoxyCodeLine{97         data\_features = load(file)}
\DoxyCodeLine{98     print(\textcolor{stringliteral}{'Photos: \%d'} \% len(data\_features))}
\DoxyCodeLine{99     \textcolor{keywordflow}{return} data\_features}

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespace_resnet__features_a6a2cb3574c119736d457d1bb165b267e}\label{namespace_resnet__features_a6a2cb3574c119736d457d1bb165b267e}} 
\index{Resnet\_features@{Resnet\_features}!ROOT\_PATH@{ROOT\_PATH}}
\index{ROOT\_PATH@{ROOT\_PATH}!Resnet\_features@{Resnet\_features}}
\doxysubsubsection{\texorpdfstring{ROOT\_PATH}{ROOT\_PATH}}
{\footnotesize\ttfamily Resnet\+\_\+features.\+R\+O\+O\+T\+\_\+\+P\+A\+TH = Path(\+\_\+\+\_\+file\+\_\+\+\_\+).absolute().parents\mbox{[}2\mbox{]}}



Definition at line 9 of file Resnet\+\_\+features.\+py.

