\hypertarget{namespaceutils}{}\doxysection{utils Namespace Reference}
\label{namespaceutils}\index{utils@{utils}}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{namespaceutils_aad973cf613e9ff6bb39f2d33834193cd}{max\+\_\+length\+\_\+caption}} (df\+\_\+path)
\item 
def \mbox{\hyperlink{namespaceutils_a01b6292fae634a5f6da3a66c96d574d6}{load\+\_\+vocabulary}} (voc\+\_\+path)
\item 
def \mbox{\hyperlink{namespaceutils_a6f4aeed7680156c2eb29e98e9ea4840f}{save\+\_\+checkpoint}} (directory, epoch, epochs\+\_\+since\+\_\+improvement, encoder, decoder, enc\+\_\+optimizer, dec\+\_\+optimizer, cider, is\+\_\+best)
\item 
def \mbox{\hyperlink{namespaceutils_a3a5ab90c7571b59ba9756fad6c06bbea}{save\+\_\+training\+\_\+log}} (path, training\+\_\+history)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespaceutils_aec52d90f85b619f574c62e27d8f91fbb}{R\+O\+O\+T\+\_\+\+P\+A\+TH}} = Path(\+\_\+\+\_\+file\+\_\+\+\_\+).absolute().parents\mbox{[}2\mbox{]}
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespaceutils_a01b6292fae634a5f6da3a66c96d574d6}\label{namespaceutils_a01b6292fae634a5f6da3a66c96d574d6}} 
\index{utils@{utils}!load\_vocabulary@{load\_vocabulary}}
\index{load\_vocabulary@{load\_vocabulary}!utils@{utils}}
\doxysubsubsection{\texorpdfstring{load\_vocabulary()}{load\_vocabulary()}}
{\footnotesize\ttfamily def utils.\+load\+\_\+vocabulary (\begin{DoxyParamCaption}\item[{}]{voc\+\_\+path }\end{DoxyParamCaption})}



Definition at line 16 of file utils.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{16 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceutils_a01b6292fae634a5f6da3a66c96d574d6}{load\_vocabulary}}(voc\_path):}
\DoxyCodeLine{17     \textcolor{comment}{\# vocabulary need to be consistent whenever this function is called}}
\DoxyCodeLine{18     \textcolor{comment}{\# vocabulary must therefore be loaded as a list}}
\DoxyCodeLine{19     \textcolor{keyword}{with} open(voc\_path, \textcolor{stringliteral}{'r'}) \textcolor{keyword}{as} voc\_file:}
\DoxyCodeLine{20         vocabulary = [word.strip() \textcolor{keywordflow}{for} word \textcolor{keywordflow}{in} voc\_file.readlines()}
\DoxyCodeLine{21                       \textcolor{keywordflow}{if} len(word) > 0]}
\DoxyCodeLine{22     vocabulary.insert(0, \textcolor{stringliteral}{'UNK'})}
\DoxyCodeLine{23     wordtoix = \{\}}
\DoxyCodeLine{24     ixtoword = \{\}}
\DoxyCodeLine{25     \textcolor{keywordflow}{for} i, word \textcolor{keywordflow}{in} enumerate(vocabulary):}
\DoxyCodeLine{26         wordtoix[word] = i}
\DoxyCodeLine{27         ixtoword[i] = word}
\DoxyCodeLine{28     \textcolor{keywordflow}{return} wordtoix, ixtoword}

\end{DoxyCode}
\mbox{\Hypertarget{namespaceutils_aad973cf613e9ff6bb39f2d33834193cd}\label{namespaceutils_aad973cf613e9ff6bb39f2d33834193cd}} 
\index{utils@{utils}!max\_length\_caption@{max\_length\_caption}}
\index{max\_length\_caption@{max\_length\_caption}!utils@{utils}}
\doxysubsubsection{\texorpdfstring{max\_length\_caption()}{max\_length\_caption()}}
{\footnotesize\ttfamily def utils.\+max\+\_\+length\+\_\+caption (\begin{DoxyParamCaption}\item[{}]{df\+\_\+path }\end{DoxyParamCaption})}



Definition at line 7 of file utils.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{7 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceutils_aad973cf613e9ff6bb39f2d33834193cd}{max\_length\_caption}}(df\_path):}
\DoxyCodeLine{8     df = pd.read\_csv(df\_path)}
\DoxyCodeLine{9     captions = set(df.loc[:, \textcolor{stringliteral}{'clean\_caption'}])}
\DoxyCodeLine{10     length = max(len(c.split()) \textcolor{keywordflow}{for} c \textcolor{keywordflow}{in} captions)}
\DoxyCodeLine{11     print(\textcolor{stringliteral}{'DATAFRAME PATH'}, df\_path)}
\DoxyCodeLine{12     print(\textcolor{stringliteral}{'MAX LENGTH OF CAPTION'}, length)}
\DoxyCodeLine{13     \textcolor{keywordflow}{return} length}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 }

\end{DoxyCode}
\mbox{\Hypertarget{namespaceutils_a6f4aeed7680156c2eb29e98e9ea4840f}\label{namespaceutils_a6f4aeed7680156c2eb29e98e9ea4840f}} 
\index{utils@{utils}!save\_checkpoint@{save\_checkpoint}}
\index{save\_checkpoint@{save\_checkpoint}!utils@{utils}}
\doxysubsubsection{\texorpdfstring{save\_checkpoint()}{save\_checkpoint()}}
{\footnotesize\ttfamily def utils.\+save\+\_\+checkpoint (\begin{DoxyParamCaption}\item[{}]{directory,  }\item[{}]{epoch,  }\item[{}]{epochs\+\_\+since\+\_\+improvement,  }\item[{}]{encoder,  }\item[{}]{decoder,  }\item[{}]{enc\+\_\+optimizer,  }\item[{}]{dec\+\_\+optimizer,  }\item[{}]{cider,  }\item[{}]{is\+\_\+best }\end{DoxyParamCaption})}



Definition at line 7 of file utils.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{7 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceutils_a6f4aeed7680156c2eb29e98e9ea4840f}{save\_checkpoint}}(directory,}
\DoxyCodeLine{8                     epoch,}
\DoxyCodeLine{9                     epochs\_since\_improvement,}
\DoxyCodeLine{10                     encoder,}
\DoxyCodeLine{11                     decoder,}
\DoxyCodeLine{12                     enc\_optimizer,}
\DoxyCodeLine{13                     dec\_optimizer,}
\DoxyCodeLine{14                     cider,}
\DoxyCodeLine{15                     is\_best):}
\DoxyCodeLine{16     directory = Path(directory)}
\DoxyCodeLine{17 }
\DoxyCodeLine{18     \textcolor{comment}{\# remove worse checkpoints}}
\DoxyCodeLine{19     \textcolor{keywordflow}{for} file \textcolor{keywordflow}{in} directory.glob(\textcolor{stringliteral}{'checkpoint\_*'}):}
\DoxyCodeLine{20         file.unlink()}
\DoxyCodeLine{21 }
\DoxyCodeLine{22     state = \{}
\DoxyCodeLine{23         \textcolor{stringliteral}{'epoch'}: epoch,}
\DoxyCodeLine{24         \textcolor{stringliteral}{'epochs\_since\_improvement'}: epochs\_since\_improvement,}
\DoxyCodeLine{25         \textcolor{stringliteral}{'cider'}: cider,}
\DoxyCodeLine{26         \textcolor{stringliteral}{'encoder'}: encoder,}
\DoxyCodeLine{27         \textcolor{stringliteral}{'decoder'}: decoder,}
\DoxyCodeLine{28         \textcolor{stringliteral}{'enc\_optimizer'}: enc\_optimizer,}
\DoxyCodeLine{29         \textcolor{stringliteral}{'dec\_optimizer'}: dec\_optimizer}
\DoxyCodeLine{30     \}}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     filename = directory.joinpath(\textcolor{stringliteral}{'checkpoint\_'} + \mbox{\hyperlink{namespacetrain__model_af1334e726c4782724a0e5b8f9e031e01}{str}}(epoch) + \textcolor{stringliteral}{'.pth.tar'})}
\DoxyCodeLine{33     torch.save(state, filename)}
\DoxyCodeLine{34     \textcolor{comment}{\# If this checkpoint is the best so far,}}
\DoxyCodeLine{35     \textcolor{comment}{\# store a copy so it doesn't get overwritten by a worse checkpoint}}
\DoxyCodeLine{36     \textcolor{keywordflow}{if} is\_best:}
\DoxyCodeLine{37         \textcolor{comment}{\# remove last best checkpoint}}
\DoxyCodeLine{38         \textcolor{keywordflow}{for} file \textcolor{keywordflow}{in} directory.glob(\textcolor{stringliteral}{'BEST\_*'}):}
\DoxyCodeLine{39             file.unlink()}
\DoxyCodeLine{40 }
\DoxyCodeLine{41         filename = directory.joinpath(\textcolor{stringliteral}{'BEST\_checkpoint.pth.tar'})}
\DoxyCodeLine{42         torch.save(state, filename)}
\DoxyCodeLine{43         \textcolor{keywordflow}{return} filename}
\DoxyCodeLine{44     \textcolor{keywordflow}{return} \textcolor{keywordtype}{None}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 }

\end{DoxyCode}
\mbox{\Hypertarget{namespaceutils_a3a5ab90c7571b59ba9756fad6c06bbea}\label{namespaceutils_a3a5ab90c7571b59ba9756fad6c06bbea}} 
\index{utils@{utils}!save\_training\_log@{save\_training\_log}}
\index{save\_training\_log@{save\_training\_log}!utils@{utils}}
\doxysubsubsection{\texorpdfstring{save\_training\_log()}{save\_training\_log()}}
{\footnotesize\ttfamily def utils.\+save\+\_\+training\+\_\+log (\begin{DoxyParamCaption}\item[{}]{path,  }\item[{}]{training\+\_\+history }\end{DoxyParamCaption})}



Definition at line 47 of file utils.\+py.


\begin{DoxyCode}{0}
\DoxyCodeLine{47 \textcolor{keyword}{def }\mbox{\hyperlink{namespaceutils_a3a5ab90c7571b59ba9756fad6c06bbea}{save\_training\_log}}(path, training\_history):}
\DoxyCodeLine{48     \textcolor{comment}{\# I do not care that the function is static}}
\DoxyCodeLine{49     \textcolor{keyword}{with} open(path, \textcolor{stringliteral}{'w'}) \textcolor{keyword}{as} train\_log:}
\DoxyCodeLine{50         train\_log.write(\textcolor{stringliteral}{'\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\# '}}
\DoxyCodeLine{51                         \textcolor{stringliteral}{'LOG FILE '}}
\DoxyCodeLine{52                         \textcolor{stringliteral}{'\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\#\(\backslash\)n\(\backslash\)n'})}
\DoxyCodeLine{53         train\_log.write(\textcolor{stringliteral}{'DATA and FEATURES\(\backslash\)n'})}
\DoxyCodeLine{54         train\_log.write(\textcolor{stringliteral}{'Training data path: '} +}
\DoxyCodeLine{55                         training\_history[\textcolor{stringliteral}{'train\_path'}] + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{56         train\_log.write(\textcolor{stringliteral}{'Feature path: '} + training\_history[\textcolor{stringliteral}{'feature\_path'}]}
\DoxyCodeLine{57                         + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{58         train\_log.write(\textcolor{stringliteral}{'Vocabulary path: '} + training\_history[\textcolor{stringliteral}{'voc\_path'}]}
\DoxyCodeLine{59                         + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{60         train\_log.write(\textcolor{stringliteral}{'Vocabulary size: '} + training\_history[\textcolor{stringliteral}{'voc\_size'}]}
\DoxyCodeLine{61                         + \textcolor{stringliteral}{'\(\backslash\)n\(\backslash\)n'})}
\DoxyCodeLine{62 }
\DoxyCodeLine{63         train\_log.write(\textcolor{stringliteral}{'\#\# CONFIGS / HYPERPARAMETERS \#\#\(\backslash\)n'})}
\DoxyCodeLine{64         train\_log.write(\textcolor{stringliteral}{'Optimizer: '} + training\_history[\textcolor{stringliteral}{'optimizer'}] +}
\DoxyCodeLine{65                         \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{66         train\_log.write(\textcolor{stringliteral}{'Learning rate: '} + training\_history[\textcolor{stringliteral}{'lr'}]}
\DoxyCodeLine{67                         + \textcolor{stringliteral}{'\(\backslash\)n\(\backslash\)n'})}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         train\_log.write(\textcolor{stringliteral}{'\#\#\#\#\#\#\# '}}
\DoxyCodeLine{70                         \textcolor{stringliteral}{'MODEL '}}
\DoxyCodeLine{71                         \textcolor{stringliteral}{'\#\#\#\#\#\#\#\(\backslash\)n'})}
\DoxyCodeLine{72         train\_log.write(\textcolor{stringliteral}{'Model name: '} + training\_history[\textcolor{stringliteral}{'model\_name'}]}
\DoxyCodeLine{73                         + \textcolor{stringliteral}{'\(\backslash\)n\(\backslash\)n'})}
\DoxyCodeLine{74         train\_log.write(training\_history[\textcolor{stringliteral}{'encoder'}] + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{75         train\_log.write(training\_history[\textcolor{stringliteral}{'decoder'}] + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{76         train\_log.write(\textcolor{stringliteral}{'Trainable parameters: '} +}
\DoxyCodeLine{77                         training\_history[\textcolor{stringliteral}{'trainable\_parameters'}] + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{78         train\_log.write(\textcolor{stringliteral}{'Model save path: '} +}
\DoxyCodeLine{79                         training\_history[\textcolor{stringliteral}{'model\_save\_path'}] + \textcolor{stringliteral}{'\(\backslash\)n\(\backslash\)n'})}
\DoxyCodeLine{80 }
\DoxyCodeLine{81         train\_log.write(\textcolor{stringliteral}{'\#\# Training Configs \#\#\(\backslash\)n'})}
\DoxyCodeLine{82         train\_log.write(\textcolor{stringliteral}{'Epochs: '} + training\_history[\textcolor{stringliteral}{'epochs'}] + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{83         train\_log.write(\textcolor{stringliteral}{'Batch size: '} + training\_history[\textcolor{stringliteral}{'batch\_size'}]}
\DoxyCodeLine{84                         + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{85         train\_log.write(\textcolor{stringliteral}{'Training time: '} +}
\DoxyCodeLine{86                         training\_history[\textcolor{stringliteral}{'training\_time'}] + \textcolor{stringliteral}{'\(\backslash\)n'})}
\DoxyCodeLine{87         train\_log.write(\textcolor{stringliteral}{'Loss function: '} + training\_history[\textcolor{stringliteral}{'loss'}]}
\DoxyCodeLine{88                         + \textcolor{stringliteral}{'\(\backslash\)n\(\backslash\)n'})}
\DoxyCodeLine{89         train\_log.write(\textcolor{stringliteral}{'\#\# Train log!\(\backslash\)n'})}
\DoxyCodeLine{90         \textcolor{comment}{\# Lastly write the training log}}
\DoxyCodeLine{91         \textcolor{keywordflow}{for} loss \textcolor{keywordflow}{in} training\_history[\textcolor{stringliteral}{'history'}]:}
\DoxyCodeLine{92             \textcolor{comment}{\# TODO: add val score.... zip?}}
\DoxyCodeLine{93             train\_log.write(\mbox{\hyperlink{namespacetrain__model_af1334e726c4782724a0e5b8f9e031e01}{str}}(round(loss, 5)) + \textcolor{stringliteral}{'\(\backslash\)n'})}

\end{DoxyCode}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespaceutils_aec52d90f85b619f574c62e27d8f91fbb}\label{namespaceutils_aec52d90f85b619f574c62e27d8f91fbb}} 
\index{utils@{utils}!ROOT\_PATH@{ROOT\_PATH}}
\index{ROOT\_PATH@{ROOT\_PATH}!utils@{utils}}
\doxysubsubsection{\texorpdfstring{ROOT\_PATH}{ROOT\_PATH}}
{\footnotesize\ttfamily utils.\+R\+O\+O\+T\+\_\+\+P\+A\+TH = Path(\+\_\+\+\_\+file\+\_\+\+\_\+).absolute().parents\mbox{[}2\mbox{]}}



Definition at line 4 of file utils.\+py.

